{% extends "admin/base.html" %}
{% load static %}

{% block title %}{% if subtitle %}{{ subtitle }} | {% endif %}{{ title }} | TWIST ERP{% endblock %}

{% block branding %}
<h1>
    <a href="{% url 'admin:index' %}">
        <img src="{% static 'brand/twist-logo.svg' %}" alt="TWIST ERP" height="30"> 
        TWIST ERP
    </a>
</h1>
{% endblock %}

{% block userlinks %}
<div style="display: flex; align-items: center; gap: 15px;">
    {% if user.is_authenticated and show_company_selector %}
        <div class="company-selector">
            <select id="company-switch" style="padding: 5px 10px; border-radius: 4px;">
                {% for company in companies %}
                    <option value="{{ company.id }}" {% if company == current_company %}selected{% endif %}>
                        {{ company.name }}
                    </option>
                {% endfor %}
            </select>
        </div>
    {% endif %}
    {{ block.super }}
</div>
{% endblock %}

{% block extrastyle %}{{ block.super }}{% endblock %}

{% block extrahead %}
{{ block.super }}
<link rel="stylesheet" href="{% static 'jazzmin/css/main.css' %}">
<link rel="icon" type="image/svg+xml" href="{% static 'brand/twist-favicon.svg' %}">
{% if admin_theme and admin_theme != 'default' %}
{% get_static_prefix as static_prefix %}
<link rel="stylesheet" href="{{ static_prefix }}vendor/bootswatch/{{ admin_theme }}/bootstrap.min.css">
<script>
  (function(){
    var darkThemes = ['cyborg','darkly','slate','solar'];
    var t = '{{ admin_theme|escapejs }}';
    if (darkThemes.indexOf(t) !== -1) {
      document.addEventListener('DOMContentLoaded', function(){
        document.body.classList.add('dark-mode');
      });
    }
  })();
  </script>
{% endif %}
<link rel="icon" type="image/svg+xml" href="{% static 'brand/twist-favicon.svg' %}">
<script>
document.addEventListener('DOMContentLoaded', function() {
    const companySwitch = document.getElementById('company-switch');
    if (companySwitch) {
        companySwitch.addEventListener('change', function() {
            const companyId = this.value;
            // Set company in session and reload
            fetch('/api/v1/set-company/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                body: JSON.stringify({ company_id: companyId })
            }).then(() => {
                window.location.reload();
            });
        });
    }
});
</script>
{% endblock %}
